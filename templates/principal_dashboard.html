{% extends 'principal_base.html' %}

{% block title %}Principal Dashboard - Student Management System{% endblock %}

{% block page_header %}Dashboard Overview{% endblock %}

{% block page_subtitle %}
<div class="flex items-center gap-4 mt-2">
    <span class="text-sm text-gray-500">
        <i class="bi bi-calendar3 mr-1"></i>
        {% now "l, F j, Y" %}
    </span>
</div>
{% endblock %}

{% block page_actions %}
<div class="flex items-center gap-3">
    <a href="{% url 'add_course' %}" 
       class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-lg hover:shadow-lg transition-all duration-200">
        <i class="bi bi-plus-circle mr-2"></i> Add Course
    </a>
    <a href="{% url 'students_list' %}" 
       class="inline-flex items-center px-4 py-2 bg-white border border-indigo-500 text-indigo-500 font-medium rounded-lg hover:bg-indigo-50 transition-colors duration-200">
        <i class="bi bi-people-fill mr-2"></i> View Students
    </a>
    <a href="{% url 'principal_course_list' %}" 
       class="inline-flex items-center px-4 py-2 bg-white border border-green-500 text-green-600 font-medium rounded-lg hover:bg-green-50 transition-colors duration-200">
        <i class="bi bi-book mr-2"></i> View All Courses
    </a>
</div>
{% endblock %}

{% block content %}
<!-- Quick Stats -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Total Students -->
    <div class="bg-white rounded-2xl shadow-sm p-6 border-l-4 border-blue-500 hover:shadow-md transition-all duration-200 hover:-translate-y-1">
        <div class="flex items-center justify-between mb-4">
            <div class="p-3 bg-blue-100 rounded-xl">
                <i class="bi bi-people text-2xl text-blue-600"></i>
            </div>
            <span class="text-green-500 font-bold text-sm">↑ 12%</span>
        </div>
        <h3 class="text-3xl font-bold text-gray-900 mb-2">{{ total_students }}</h3>
        <p class="text-gray-600 text-sm">Total Students</p>
    </div>

    <!-- Total Courses -->
    <div class="bg-white rounded-2xl shadow-sm p-6 border-l-4 border-green-500 hover:shadow-md transition-all duration-200 hover:-translate-y-1">
        <div class="flex items-center justify-between mb-4">
            <div class="p-3 bg-green-100 rounded-xl">
                <i class="bi bi-book text-2xl text-green-600"></i>
            </div>
            <span class="text-blue-500 font-bold text-sm">→ 0%</span>
        </div>
        <h3 class="text-3xl font-bold text-gray-900 mb-2">{{ total_courses }}</h3>
        <p class="text-gray-600 text-sm">Total Courses</p>
    </div>

    <!-- Departments -->
    <div class="bg-white rounded-2xl shadow-sm p-6 border-l-4 border-yellow-500 hover:shadow-md transition-all duration-200 hover:-translate-y-1">
        <div class="flex items-center justify-between mb-4">
            <div class="p-3 bg-yellow-100 rounded-xl">
                <i class="bi bi-building text-2xl text-yellow-600"></i>
            </div>
            <span class="text-green-500 font-bold text-sm">↑ 5%</span>
        </div>
        <h3 class="text-3xl font-bold text-gray-900 mb-2">{{ total_departments }}</h3>
        <p class="text-gray-600 text-sm">Departments</p>
    </div>

    <!-- Pending Requests -->
    <div class="bg-white rounded-2xl shadow-sm p-6 border-l-4 border-red-500 hover:shadow-md transition-all duration-200 hover:-translate-y-1">
        <div class="flex items-center justify-between mb-4">
            <div class="p-3 bg-red-100 rounded-xl">
                <i class="bi bi-clock-history text-2xl text-red-600"></i>
            </div>
            <span class="text-yellow-500 font-bold text-sm">↑ 8%</span>
        </div>
        <h3 class="text-3xl font-bold text-gray-900 mb-2">{{ pending_requests }}</h3>
        <p class="text-gray-600 text-sm">Pending Requests</p>
    </div>
</div>

<!-- PENDING APPROVALS SECTION -->
{% if pending_approvals %}
<div class="bg-white rounded-2xl shadow-sm overflow-hidden mb-8">
    <div class="bg-gradient-to-r from-yellow-100 to-yellow-50 border-b border-yellow-200 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-yellow-500 rounded-lg">
                    <i class="bi bi-hourglass-split text-white text-xl"></i>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-gray-900">Pending Course Approvals</h3>
                    <p class="text-yellow-700 text-sm">Action required for {{ pending_approvals|length }} request{{ pending_approvals|length|pluralize }}</p>
                </div>
            </div>
            <span class="bg-yellow-500 text-white text-sm font-bold px-3 py-1 rounded-full">
                {{ pending_approvals|length }}
            </span>
        </div>
    </div>
    
    <div class="p-6">
        <div class="overflow-x-auto rounded-xl border border-gray-200">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reg No</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Requested</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Request Date</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {% for approval in pending_approvals %}
                    <tr class="hover:bg-yellow-50 transition-colors duration-150">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    <div class="h-10 w-10 rounded-full bg-yellow-100 flex items-center justify-center">
                                        <i class="bi bi-person-circle text-yellow-600"></i>
                                    </div>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">
                                        {{ approval.student.first_name }} {{ approval.student.last_name }}
                                    </div>
                                    <div class="text-sm text-gray-500">{{ approval.student.email }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-3 py-1 bg-gray-100 text-gray-800 text-sm font-mono rounded-lg">
                                {{ approval.student.std_reg_no }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% if approval.student.std_dept %}
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">
                                {{ approval.student.std_dept.dept_name }}
                            </span>
                            {% else %}
                            <span class="px-3 py-1 bg-gray-100 text-gray-800 text-xs font-medium rounded-full">N/A</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4">
                            <div class="text-sm font-medium text-gray-900">{{ approval.course.course_name }}</div>
                            <div class="text-sm text-gray-500">
                                <span class="font-mono">ID: {{ approval.course.course_id }}</span>
                                {% if approval.course.department %}
                                <span class="ml-2 flex items-center">
                                    <i class="bi bi-building mr-1"></i> 
                                    {{ approval.course.department.dept_name }}
                                </span>
                                {% endif %}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="text-green-600 font-bold text-lg">₹{{ approval.course.course_price }}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">
                                {{ approval.purchased_at|date:"d M Y" }}
                            </div>
                            <div class="text-xs text-gray-500">
                                {{ approval.purchased_at|timesince }} ago
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center gap-2">
                                <form method="POST" class="inline">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="approve_course">
                                    <input type="hidden" name="approval_id" value="{{ approval.id }}">
                                    <button type="submit" 
                                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 text-sm font-medium flex items-center gap-2">
                                        <i class="bi bi-check-lg"></i>
                                    </button>
                                </form>
                                <form method="POST" class="inline">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="reject_course">
                                    <input type="hidden" name="approval_id" value="{{ approval.id }}">
                                    <button type="submit" 
                                            class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 text-sm font-medium flex items-center gap-2">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

<!-- Departments Overview Section -->
<div class="bg-white rounded-2xl shadow-sm overflow-hidden mb-8">
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-white/20 rounded-lg">
                    <i class="bi bi-building text-white text-xl"></i>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-white">Departments Overview</h3>
                    <p class="text-indigo-100 text-sm">Quick view of all academic departments</p>
                </div>
            </div>
            <span class="bg-white text-indigo-600 text-sm font-bold px-3 py-1 rounded-full">
                {{ total_departments }} Department{{ total_departments|pluralize }}
            </span>
        </div>
    </div>
    
    <div class="p-6">
        {% if departments_with_courses %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {% for dept in departments_with_courses %}
            <a href="{% url 'course_list' %}?department={{ dept.id }}" 
               class="bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 hover:border-indigo-300 transition-all duration-200 hover:shadow-md hover:-translate-y-1 block">
                <div class="p-5">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-indigo-100 rounded-lg">
                                <i class="bi bi-building text-indigo-600"></i>
                            </div>
                            <h4 class="text-lg font-bold text-gray-900">{{ dept.dept_name }}</h4>
                        </div>
                        <i class="bi bi-arrow-right text-indigo-600"></i>
                    </div>
                    
                    <p class="text-gray-600 text-sm mb-4 line-clamp-2">{{ dept.dept_description|truncatechars:100 }}</p>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-indigo-600">{{ dept.course_count }}</div>
                                <div class="text-xs text-gray-500">Courses</div>
                            </div>
                        </div>
                        <span class="bg-indigo-50 text-indigo-700 text-xs font-bold px-3 py-1 rounded-full">
                            View Courses
                        </span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
        
        <!-- Quick Actions -->
        <div class="mt-8 pt-6 border-t border-gray-200">
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                <p class="text-gray-600 text-sm">
                    <i class="bi bi-info-circle mr-2"></i>
                    Click on any department to view detailed course information
                </p>
                <a href="{% url 'course_list' %}" 
                   class="inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-lg hover:shadow-lg transition-all duration-200">
                    <i class="bi bi-book mr-2"></i>
                    View All Courses
                </a>
            </div>
        </div>
        {% else %}
        <div class="text-center py-12">
            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="bi bi-building text-gray-400 text-4xl"></i>
            </div>
            <h4 class="text-xl font-bold text-gray-700 mb-2">No Departments Found</h4>
            <p class="text-gray-500 mb-6">Start by creating your first department</p>
            <a href="#" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-lg hover:shadow-lg transition-all duration-200">
                <i class="bi bi-plus-circle mr-2"></i> 
                Create First Department
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Animate department cards on load
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.bg-gradient-to-br.from-gray-50.to-white');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'opacity 0.5s, transform 0.5s';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    });
</script>
{% endblock %}